dast_scan:
    name: Run OWASP ZAP (DAST)
    runs-on: ubuntu-latest
    needs: sast_scan
    steps:
      - name: Checkout code
        uses: actions/checkout@v4 # Actualizado a v4

      - name: Start Application
        run: |
          pip install flask
          # Importante: Correr en modo seguro para el escaneo
          python app.py & 
          sleep 10 # Damos un poco m치s de tiempo para que inicie

      - name: ZAP Scan
        # Usamos una versi칩n m치s reciente que ya apunta al nuevo repositorio
        uses: zaproxy/action-baseline@v0.12.0 
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          target: 'http://127.0.0.1:5000/search?id=1'
          # Esta opci칩n ayuda si el contenedor de ZAP tiene problemas de red con localhost
          docker_name: 'ghcr.io/zaproxy/zaproxy:stable'